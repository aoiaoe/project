server:
  port: 10020
  servlet:
    context-path: /gw
spring:
  application:
    name: nacos-config-sentinel-gw
  cloud:
    nacos:
      discovery:
        enabled: true
        server-addr: http://tx-gd:8948
        namespace: dev
        username: nacos
        password: nacos
        metadata:
          management:
            context-path: ${server.servlet.context-path}/actuator
      config:
        server-addr: http://tx-gd:8948
        namespace: dev
        username: nacos
        password: nacos
        file-extension: yml
    sentinel:
      transport:
        dashboard: localhost:9999
      eager: true # 启动即注册限流规则到sentinel，否则会延迟到请求之后才会注册到sentinel
      # 设置sentinel数据源
      datasource:
        # 文件保存限流配置， 相当于半个静态配置
        # 如果文件位于项目中，则是静态
        # 如果文件位于外部存储，则是动态
#        ds1.file:
#          file: classpath:flowrule/flow-rule.json
#          ruleType: gw-flow # 限流规则
#        ds2.file:
#          #file: classpath:flowrule/flow-rule-api.json
#          file: /Users/sephiroth/Documents/flow-rule-api.json
#          ruleType: gw-api-group # api分组
        ds1.nacos:
          serverAddr: ${spring.cloud.nacos.discovery.server-addr}
          username: nacos
          password: nacos
          namespace: dev-gw
          ruleType: gw-flow
          dataId: ${spring.application.name}-sentinel-rule.json
          data-type: json
        ds2.nacos:
          serverAddr: ${spring.cloud.nacos.discovery.server-addr}
          username: nacos
          password: nacos
          namespace: dev-gw
          ruleType: gw-api-group
          dataId: ${spring.application.name}-sentinelapi-rule.json
          data-type: json
    loadbalancer:
      cache:
        enabled: true
    gateway:
      discovery:
        locator:
          enabled: true
          lower-case-service-id: true

  main:
    allow-bean-definition-overriding: true

#  sleuth:
#    reactor:
#      #在2020.0.0中，已将默认网关反应器检测模式更改为manual,
#      #ON_EACH-用跟踪表示形式包装每个Reactor运算符。在大多数情况下，传递跟踪上下文。此模式可能会导致性能急剧下降。
#      #ON_LAST-将最后一个Reactor运算符包装在跟踪表示中。在某些情况下传递跟踪上下文，
#      #因此访问MDC上下文可能不起作用。此模式可能会导致中等性能下降。
#      #MANUAL-以最小侵入性的方式包装每个Reactor，而无需通过跟踪上下文。由用户决定
#      instrumentation-type: decorate_on_each
gateway:
  data-id: ${spring.application.name}.json
  group: DEFAULT_GROUP
  time-out: 3000
    # 静态路由
  # demo
  #    gateway:
  #      routes:
  #        - id: path-rout # 路由id
  #          uri: 127.0.0.1:10000/user # 匹配路由地址
  #          predicates: # 断言
  #            - Path=/user
  # 允许重名覆盖
  main:
    allow-bean-definition-overriding: true

# 暴露端点
management:
  endpoints:
    web:
      exposure:
        include: '*'
  endpoint:
    health:
      show-details: always
#debug: true

logging:
  level:
    org.springframework.cloud.gateway: trace